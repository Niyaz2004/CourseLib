extends layout

block content
  .container
    h1 Edit Course
    form#editCourseForm(method="POST" action=`/api/v1/courses/${course._id}?_method=PUT` enctype="multipart/form-data")
      // Step 1
      .form-step#step1
        .form-group
          label(for="title") Course Title
          input#title.form-control(type="text" name="title" required value=course.title)
        .form-group
          label(for="description") Description
          textarea#description.form-control(name="description" rows="4" required)= course.description
        button.btn.btn-primary(type="button" id="nextBtn1") Next

      // Step 2
      .form-step#step2(style="display:none;")
        .form-group
          label(for="weeks") Duration (weeks)
          input#weeks.form-control(type="number" name="weeks" min="1" required value=course.weeks)
        .form-group
          label(for="tuition") Tuition Cost
          input#tuition.form-control(type="number" name="tuition" min="0" required value=course.tuition)
        button.btn.btn-secondary(type="button" id="prevBtn2") Previous
        button.btn.btn-primary(type="button" id="nextBtn2") Next

      // Step 3
      .form-step#step3(style="display:none;")
        .form-group
          label(for="minimumSkill") Minimum Skill Required
          select#minimumSkill.form-control(name="minimumSkill" required)
            option(value="beginner" selected=course.minimumSkill=='beginner') Beginner
            option(value="intermediate" selected=course.minimumSkill=='intermediate') Intermediate
            option(value="advanced" selected=course.minimumSkill=='advanced') Advanced
        .form-group
          label.checkbox-label
            input#scholarshipsAvailable(type="checkbox" name="scholarshipsAvailable" checked=course.scholarshipsAvailable)
            span Scholarships Available
        button.btn.btn-secondary(type="button" id="prevBtn3") Previous
        button.btn.btn-primary(type="button" id="nextBtn3") Next

      // Step 4 - Modules and Lessons
      .form-step#step4(style="display:none;")
        #modules-container
          h3 Modules
          if course.modules && course.modules.length > 0
            each module, moduleIndex in course.modules
              .module(data-module-index=moduleIndex)
                h4 Module #{moduleIndex + 1}
                .form-group
                  label Module Title
                  input.form-control(type="text" name=`module_${moduleIndex}_title` required value=module.title)
                .lessons-container
                  if module.lessons && module.lessons.length > 0
                    each lesson, lessonIndex in module.lessons
                      .lesson(data-lesson-index=lessonIndex)
                        h5 Lesson #{lessonIndex + 1}
                        .form-group
                          label Lesson Title
                          input.form-control(type="text" name=`module_${moduleIndex}_lesson_${lessonIndex}_title` required value=lesson.title)
                        .form-group
                          label Lesson Text
                          textarea.form-control(name=`module_${moduleIndex}_lesson_${lessonIndex}_text` rows="3" required)= lesson.text
                        .form-group
                          label Lesson Video File
                          // Всегда показываем блок управления видео
                          .video-control
                            if lesson.video
                              if lesson.videoFile
                                p Current video: #{lesson.videoFile.filename}
                              else
                                p Video ID: #{lesson.video}
                              
                              label.checkbox-label
                                input(
                                  type="checkbox"
                                  name="deleteVideos"
                                  value=lesson.video
                                )
                                span Remove current video
                              
                              input(type="hidden" name=`module_${moduleIndex}_lesson_${lessonIndex}_existingVideo` value=lesson.video)
                            else
                              p No video uploaded
                            
                            input.form-control(type="file" name=`module_${moduleIndex}_lesson_${lessonIndex}_video` accept="video/*")
                        button.btn.btn-danger.btn-sm.remove-lesson-btn(type="button") Remove Lesson
                button.btn.btn-primary.btn-sm.add-lesson-btn(type="button") Add Lesson
                button.btn.btn-danger.btn-sm.remove-module-btn(type="button") Remove Module
          button.btn.btn-sm.btn-success(type="button" id="addModuleBtn") Add Module
        button.btn.btn-secondary(type="button" id="prevBtn4") Previous
        button.btn.btn-primary(type="submit") Update Course

  script.
    window.courseData = !{JSON.stringify(course)};
  script(src="/js/courseForm.js")