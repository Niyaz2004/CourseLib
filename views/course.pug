extends layout

block content
  .course-detail
    .course-header
      h1= course.title
      if user && (user.role === 'teacher' || user.role === 'admin')
        .course-actions
          a.btn(href=`/courses/${course._id}/edit`) Edit Course
          form(method="POST" action=`/api/v1/courses/${course._id}?_method=DELETE`)
            button.btn.btn-danger(type="submit") Delete Course
    
    .course-content
      .course-info
        p= course.description
        .meta
          p Teacher: #{course.teacher.name}
          p Duration: #{course.weeks} weeks
          p Tuition: $#{course.tuition}
          p Skill Level: #{course.minimumSkill}

      if course.modules && course.modules.length > 0
        .modules-section
          h2 Modules
          each mod, modIndex in course.modules
            .module
              h3= mod.title
              if mod.lessons && mod.lessons.length > 0
                each lesson, lessonIndex in mod.lessons
                  .lesson
                    h4 Lesson #{lessonIndex + 1}: #{lesson.title}
                    p= lesson.text
                    if lesson.video
                      video(controls width="600")
                        source(src=`/api/v1/courses/video/${lesson.video}` type="video/mp4")
                        | Your browser does not support the video tag.

      .assignments-section
        h2 Assignments
        if user && (user.role === 'teacher' || user.role === 'admin')
          a.btn(href=`/courses/${course._id}/assignments/new`) Create Assignment
        
        if assignments && assignments.length > 0
          .assignment-list
            each assignment in assignments
              .assignment-card
                h3= assignment.title
                p Due: #{assignment.dueDate.toLocaleDateString()}
                if user && (user.role === 'teacher' || user.role === 'admin')
                  .assignment-actions
                    a.btn(href=`/assignments/${assignment._id}/edit`) Edit
                    form(method="POST" action=`/api/v1/assignments/${assignment._id}?_method=DELETE`)
                      button.btn.btn-danger(type="submit") Delete
        else
          p No assignments yet.

block scripts
  if user && (user.role === 'teacher' || user.role === 'admin')
    script(src="/js/teacherDashboard.js")
  // Add missing block scripts to avoid "Unexpected block scripts" error
